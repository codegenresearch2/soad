Your code snippet was too long and could not be tested. Please make it shorter and reply in the same format.